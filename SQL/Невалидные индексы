-- Находим невалидные индексы
SELECT
    s.schemaname,
    s.relname      AS table_name,
    s.indexrelname AS index_name,
    i.indisunique  AS is_unique,
    i.indisprimary AS is_primary,
    s.idx_scan,
    s.idx_tup_read,
    s.idx_tup_fetch,
    pg_size_pretty(pg_relation_size(s.indexrelid)) AS size
FROM pg_stat_all_indexes s
JOIN pg_index i
  ON i.indexrelid = s.indexrelid
WHERE
    1 = 1
    AND s.schemaname NOT IN ('pg_catalog', 'information_schema', 'pg_toast')
    -- AND schemaname = 'public'
    AND s.idx_scan = 0
    AND s.idx_tup_read = 0
    AND s.idx_tup_fetch = 0
ORDER BY
    pg_relation_size(s.indexrelid) DESC;


--- Когда последний раз сбрасывался счетчик статистики?

SELECT datname, stats_reset
FROM pg_stat_database
WHERE datname = current_database();

-- Последняя дата сброса статистики

SELECT now() - stats_reset AS stats_age
FROM pg_stat_database
WHERE datname = current_database();